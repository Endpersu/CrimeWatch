{% extends 'base.html' %}

{% block title %}Список дел — CrimeWatch{% endblock %}

{% block content %}
  <div class="container">
    <h2>Список дел</h2>

    <!-- Боковая панель фильтров -->
    <div class="sidebar">
      <h3>Фильтры</h3>
      <form method="GET">
        <div>
          <label>Тип преступления:</label>
          <select name="crime_type">
            <option value="">Все</option>
            <option value="1" {% if request.GET.crime_type == "1" %}selected{% endif %}>Физические</option>
            <option value="2" {% if request.GET.crime_type == "2" %}selected{% endif %}>Киберпреступления</option>
          </select>
        </div>

        <div>
          <label>Категории:</label>
          <div>
            <input type="checkbox" name="categories" value="1" id="cat1" {% if "1" in request.GET.categories %}checked{% endif %}>
            <label for="cat1">Обычные</label>
          </div>
          <div>
            <input type="checkbox" name="categories" value="2" id="cat2" {% if "2" in request.GET.categories %}checked{% endif %}>
            <label for="cat2">Жестокие</label>
          </div>
          <div>
            <input type="checkbox" name="categories" value="3" id="cat3" {% if "3" in request.GET.categories %}checked{% endif %}>
            <label for="cat3">Неразгаданные</label>
          </div>
        </div>

        <div>
          <label>Статус:</label>
          <select name="is_solved">
            <option value="">Все</option>
            <option value="1" {% if request.GET.is_solved == "1" %}selected{% endif %}>Раскрыто</option>
            <option value="0" {% if request.GET.is_solved == "0" %}selected{% endif %}>Не раскрыто</option>
          </select>
        </div>

        <div>
          <input type="text" name="q" placeholder="Поиск по заголовку..." value="{{ request.GET.q }}">
        </div>

        <button type="submit">Применить</button>
        <a href="{% url 'case_list' %}" class="btn-reset">Сбросить</a>
      </form>
    </div>

    <!-- Основная область -->
    <div class="main-content-area">
      <!-- Сортировка -->
      <div class="sort-bar">
        <span>Сортировать по:</span>
        <a href="?{% if request.GET.crime_type %}crime_type={{ request.GET.crime_type }}&{% endif %}{% if request.GET.categories %}categories={{ request.GET.categories|join:'&categories=' }}&{% endif %}{% if request.GET.is_solved %}is_solved={{ request.GET.is_solved }}&{% endif %}order=date">Дата ▼</a>
        <a href="#">Популярности</a>
        <a href="#">Статусу</a>
      </div>

      <!-- Карточки дел -->
      <div class="case-grid">
        {% for case in cases %}
          <div class="case-card">
            <h3>{{ case.title }}</h3>
            <div class="tags">
              {% for cat in case.categories.all %}
                <span class="tag tag-{{ cat.slug }}">{{ cat.name }}</span>
              {% endfor %}
            </div>
            <p>{{ case.description|truncatewords:20 }}</p>
            <small>{{ case.date_occurred }} • {{ case.location }}</small>
            <a href="{% url 'case_detail' case.pk %}" class="btn-more">Подробнее</a>
          </div>
        {% empty %}
          <p>Нет дел по заданным фильтрам.</p>
        {% endfor %}
      </div>

      <!-- Пагинация -->
      {% if cases.has_other_pages %}
        <div class="pagination">
          {% if cases.has_previous %}
            <a href="?page=1">&laquo; Первая</a>
            <a href="?page={{ cases.previous_page_number }}">← Предыдущая</a>
          {% endif %}

          {% for i in cases.paginator.page_range %}
            {% if cases.number == i %}
              <span class="current">{{ i }}</span>
            {% else %}
              <a href="?page={{ i }}">{{ i }}</a>
            {% endif %}
          {% endfor %}

          {% if cases.has_next %}
            <a href="?page={{ cases.next_page_number }}">Следующая →</a>
            <a href="?page={{ cases.paginator.num_pages }}">Последняя &raquo;</a>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </div>
{% endblock %}